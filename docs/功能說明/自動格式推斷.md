# ğŸ¯ è‡ªå‹•æ ¼å¼æ¨æ–·ç³»çµ±

> ConvertX-CN é€éæœ¬åœ°å°æ¨¡å‹èˆ‡è¡Œç‚ºå­¸ç¿’ï¼Œè‡ªå‹•æ¨æ–·ä½¿ç”¨è€…æœ€å¯èƒ½çš„æ ¼å¼æœå°‹èˆ‡å¼•æ“é¸æ“‡ï¼Œä¸¦åœ¨ä¸å¹²æ“¾æ“ä½œè‡ªç”±çš„å‰æä¸‹ï¼Œæå‰å®Œæˆå¼•æ“æº–å‚™ä»¥é™ä½è½‰æª”å»¶é²ã€‚

## âœ¨ æ ¸å¿ƒäº®é»

- **ğŸ§  æ™ºèƒ½æ¨æ–·**ï¼šåŸºæ–¼æª”æ¡ˆç‰¹å¾µ + ä½¿ç”¨è€…æ­·å²è¡Œç‚ºï¼Œè‡ªå‹•é æ¸¬æœ€å¯èƒ½çš„ç›®æ¨™æ ¼å¼
- **âš¡ å¼•æ“é èª¿ç”¨**ï¼šé«˜ä¿¡å¿ƒåº¦æ™‚æå‰ warm-up å¼•æ“ï¼Œé™ä½å†·å•Ÿå‹•å»¶é²
- **ğŸ“Š æŒçºŒå­¸ç¿’**ï¼šæ¯æ¬¡è½‰æª”éƒ½æœƒæ›´æ–°ä½¿ç”¨è€…åå¥½æ¨¡å‹ï¼Œæ¨è–¦è¶Šç”¨è¶Šæº–
- **ğŸ”’ å®Œå…¨æœ¬åœ°**ï¼šä¸ä½¿ç”¨ä»»ä½•ä»˜è²» APIï¼Œæ‰€æœ‰æ¨æ–·åœ¨æœ¬åœ°å®Œæˆ
- **ğŸ›ï¸ ç„¡å¹²æ“¾è¨­è¨ˆ**ï¼šä½¿ç”¨è€…å¯éš¨æ™‚é»æ“Š X æ¸…é™¤æ¨è–¦ï¼Œç³»çµ±æœƒè¨˜éŒ„ç‚ºè² æ¨£æœ¬

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

```
[æª”æ¡ˆä¸Šå‚³] â†’ [ç‰¹å¾µæŠ½å–] â†’ [æ ¼å¼å€™é¸ç”Ÿæˆ] â†’ [æ ¼å¼é æ¸¬æ¨¡å‹] â†’ [å¼•æ“é æ¸¬æ¨¡å‹] â†’ [é èª¿ç”¨]
                                â†‘                    â†‘                â†‘
                           è¦å‰‡é…ç½®             ä½¿ç”¨è€… Profile       å¼•æ“èƒ½åŠ›çŸ©é™£
```

## ğŸ“ æ¨¡çµ„çµæ§‹

```
src/inference/
â”œâ”€â”€ index.ts                 # çµ±ä¸€å°å‡º
â”œâ”€â”€ inferenceService.ts      # æ¨æ–·æœå‹™ä¸»å…¥å£
â”œâ”€â”€ featureExtraction.ts     # æª”æ¡ˆç‰¹å¾µæŠ½å–
â”œâ”€â”€ formatCandidateRules.ts  # æ ¼å¼å€™é¸è¦å‰‡é…ç½®
â”œâ”€â”€ formatPredictionModel.ts # æ ¼å¼é æ¸¬æ¨¡å‹
â”œâ”€â”€ enginePredictionModel.ts # å¼•æ“é æ¸¬æ¨¡å‹
â”œâ”€â”€ behaviorStore.ts         # ä½¿ç”¨è€…è¡Œç‚ºè³‡æ–™å„²å­˜
â””â”€â”€ engineWarmup.ts          # å¼•æ“é èª¿ç”¨ç®¡ç†

public/
â””â”€â”€ inference.js             # å‰ç«¯æ¨æ–·æ•´åˆ

src/pages/
â””â”€â”€ inference.tsx            # æ¨æ–· API ç«¯é»
```

## ğŸ”§ ä½¿ç”¨æ–¹å¼

### å¾Œç«¯ API

```typescript
// è«‹æ±‚æ ¼å¼æ¨æ–·
POST /inference/predict
{
  "ext": "jpg",
  "file_size_kb": 2400
}

// å›æ‡‰
{
  "success": true,
  "data": {
    "format": {
      "search_format": "png",
      "confidence": 0.82,
      "top_k": [
        { "format": "png", "score": 0.82 },
        { "format": "webp", "score": 0.75 }
      ]
    },
    "engine": {
      "engine": "vips",
      "confidence": 0.88,
      "should_warmup": true
    },
    "should_auto_fill": true
  }
}
```

### å‰ç«¯æ•´åˆ

```javascript
// ä¸Šå‚³æª”æ¡ˆå¾Œè‡ªå‹•è§¸ç™¼æ¨æ–·
if (window.inferenceModule) {
  const result = await inferenceModule.requestFormatInference("jpg", 2400);
  if (result?.should_auto_fill) {
    inferenceModule.autoFillInferredFormat(result.format.search_format);
  }
}
```

## ğŸ“Š è³‡æ–™ Schema

### è½‰æª”äº‹ä»¶

```json
{
  "event": "conversion_completed",
  "user_id": 123,
  "input_ext": "jpg",
  "searched_format": "png",
  "selected_engine": "vips",
  "success": true,
  "duration_ms": 820
}
```

### ä½¿ç”¨è€… Profile

```json
{
  "user_id": 123,
  "format_preferences": {
    "jpg->png": 0.71,
    "jpg->webp": 0.19
  },
  "engine_preferences": {
    "png": { "vips": 0.65, "imagemagick": 0.3 }
  },
  "recent_formats": ["png", "webp", "pdf"]
}
```

## âš™ï¸ é…ç½®é¸é …

åœ¨ `InferenceServiceConfig` ä¸­å¯é…ç½®ï¼š

| é¸é …                        | é è¨­å€¼ | èªªæ˜               |
| --------------------------- | ------ | ------------------ |
| `formatConfidenceThreshold` | 0.4    | æ ¼å¼æ¨æ–·æœ€ä½ä¿¡å¿ƒåº¦ |
| `engineConfidenceThreshold` | 0.5    | å¼•æ“æ¨æ–·æœ€ä½ä¿¡å¿ƒåº¦ |
| `enableWarmup`              | true   | æ˜¯å¦å•Ÿç”¨é èª¿ç”¨     |
| `warmupConfidenceThreshold` | 0.7    | é èª¿ç”¨è§¸ç™¼é–¾å€¼     |

## ğŸ§ª é©—æ”¶æ¸¬è©¦

- âœ… ä½¿ç”¨è€…æ­·å²åå¥½ `jpgâ†’png` â†’ æ–° jpg è‡ªå‹•å¡« `png`
- âœ… é«˜è§£æ jpg â†’ vips å„ªå…ˆæ–¼ imagemagick
- âœ… å°åœ–ç¤º jpg â†’ imagemagick å„ªå…ˆ
- âœ… ä¸æœƒåœ¨åœ–ç‰‡æµç¨‹é èª¿ç”¨ ffmpeg
- âœ… ä½¿ç”¨è€…é» X â†’ æ¨æ–·è¢«è¨˜ç‚ºè² æ¨£æœ¬
- âœ… å¤šæ¬¡ä½¿ç”¨å¾Œæ¨è–¦æº–ç¢ºç‡æå‡

# é–‹ç™¼èˆ‡è²¢ç»æŒ‡å—

æ­¡è¿åƒèˆ‡ ConvertX-CN çš„é–‹ç™¼ï¼æœ¬æ–‡ä»¶èªªæ˜å°ˆæ¡ˆçµæ§‹ã€é–‹ç™¼æµç¨‹èˆ‡è²¢ç»è¦ç¯„ã€‚

---

## ç›®éŒ„

- [å°ˆæ¡ˆçµæ§‹](#å°ˆæ¡ˆçµæ§‹)
- [æœ¬åœ°é–‹ç™¼ç’°å¢ƒ](#æœ¬åœ°é–‹ç™¼ç’°å¢ƒ)
- [åˆ†æ”¯ç­–ç•¥](#åˆ†æ”¯ç­–ç•¥)
- [æ¸¬è©¦æµç¨‹](#æ¸¬è©¦æµç¨‹)
- [æäº¤è¦ç¯„](#æäº¤è¦ç¯„)
- [Pull Request æµç¨‹](#pull-request-æµç¨‹)
- [ç¨‹å¼ç¢¼é¢¨æ ¼](#ç¨‹å¼ç¢¼é¢¨æ ¼)

---

## å°ˆæ¡ˆçµæ§‹

```
ConvertX-CN/
â”œâ”€â”€ src/                    # å‰ç«¯åŸå§‹ç¢¼
â”‚   â”œâ”€â”€ index.tsx           # ä¸»å…¥å£
â”‚   â”œâ”€â”€ main.css            # ä¸»æ¨£å¼
â”‚   â”œâ”€â”€ components/         # React å…ƒä»¶
â”‚   â”œâ”€â”€ converters/         # è½‰æ›å™¨å®šç¾©
â”‚   â”œâ”€â”€ db/                 # è³‡æ–™åº«ç›¸é—œ
â”‚   â”œâ”€â”€ helpers/            # å·¥å…·å‡½æ•¸
â”‚   â”œâ”€â”€ i18n/               # åœ‹éš›åŒ–
â”‚   â”œâ”€â”€ icons/              # åœ–ç¤ºå…ƒä»¶
â”‚   â”œâ”€â”€ locales/            # ç¿»è­¯æª”æ¡ˆ
â”‚   â”œâ”€â”€ pages/              # é é¢å…ƒä»¶
â”‚   â”œâ”€â”€ theme/              # ä¸»é¡Œç›¸é—œ
â”‚   â””â”€â”€ transfer/           # æª”æ¡ˆå‚³è¼¸
â”‚
â”œâ”€â”€ api-server/             # Rust API Serverï¼ˆé¸ç”¨ï¼‰
â”‚   â”œâ”€â”€ src/                # Rust åŸå§‹ç¢¼
â”‚   â”‚   â”œâ”€â”€ main.rs         # å…¥å£é»
â”‚   â”‚   â”œâ”€â”€ auth.rs         # èªè­‰æ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ config.rs       # è¨­å®šæ¨¡çµ„
â”‚   â”‚   â”œâ”€â”€ conversion.rs   # è½‰æ›é‚è¼¯
â”‚   â”‚   â”œâ”€â”€ graphql.rs      # GraphQL ç«¯é»
â”‚   â”‚   â””â”€â”€ rest.rs         # REST ç«¯é»
â”‚   â”œâ”€â”€ docs/               # API æ–‡ä»¶
â”‚   â””â”€â”€ tests/              # æ¸¬è©¦
â”‚
â”œâ”€â”€ docs/                   # å°ˆæ¡ˆæ–‡ä»¶
â”œâ”€â”€ tests/                  # æ¸¬è©¦
â”‚   â”œâ”€â”€ converters/         # è½‰æ›å™¨æ¸¬è©¦
â”‚   â”œâ”€â”€ e2e/                # ç«¯å°ç«¯æ¸¬è©¦
â”‚   â””â”€â”€ transfer/           # å‚³è¼¸æ¸¬è©¦
â”‚
â”œâ”€â”€ scripts/                # è…³æœ¬
â”‚   â”œâ”€â”€ download-models.sh  # ä¸‹è¼‰æ¨¡å‹
â”‚   â”œâ”€â”€ install-fonts.sh    # å®‰è£å­—å‹
â”‚   â””â”€â”€ verify-*.sh         # é©—è­‰è…³æœ¬
â”‚
â”œâ”€â”€ public/                 # éœæ…‹è³‡æº
â”œâ”€â”€ data/                   # è³‡æ–™ç›®éŒ„ï¼ˆruntimeï¼‰
â”‚
â”œâ”€â”€ Dockerfile              # ä¸€èˆ¬ç‰ˆå»ºæ§‹æª”
â”œâ”€â”€ Dockerfile.lite         # Lite ç‰ˆå»ºæ§‹æª”
â”œâ”€â”€ Dockerfile.full         # Full ç‰ˆå»ºæ§‹æª”
â”œâ”€â”€ compose.yaml            # Docker Compose
â”œâ”€â”€ package.json            # Node.js ä¾è³´
â”œâ”€â”€ tsconfig.json           # TypeScript è¨­å®š
â””â”€â”€ biome.json              # Linter è¨­å®š
```

---

## æŠ€è¡“æ£§

### å‰ç«¯ / Web Server

| æŠ€è¡“        | ç”¨é€”               |
| ----------- | ------------------ |
| Bun         | JavaScript Runtime |
| Elysia      | Web æ¡†æ¶           |
| React       | UI å…ƒä»¶            |
| TailwindCSS | æ¨£å¼æ¡†æ¶           |
| TypeScript  | é¡å‹å®‰å…¨           |
| SQLite      | è³‡æ–™åº«             |

### API Serverï¼ˆé¸ç”¨ï¼‰

| æŠ€è¡“          | ç”¨é€”         |
| ------------- | ------------ |
| Rust          | èªè¨€         |
| Axum          | Web æ¡†æ¶     |
| async-graphql | GraphQL      |
| tokio         | éåŒæ­¥é‹è¡Œæ™‚ |

---

## æœ¬åœ°é–‹ç™¼ç’°å¢ƒ

### å‰ç½®éœ€æ±‚

- Node.js 20+ æˆ– Bun 1.0+
- Dockerï¼ˆç”¨æ–¼æ¸¬è©¦ï¼‰
- Git

### è¨­å®šæ­¥é©Ÿ

1. **Clone å°ˆæ¡ˆ**

   ```bash
   git clone https://github.com/pi-docket/ConvertX-CN.git
   cd ConvertX-CN
   ```

2. **å®‰è£ä¾è³´**

   ```bash
   # ä½¿ç”¨ Bun
   bun install

   # æˆ–ä½¿ç”¨ npm
   npm install
   ```

3. **å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨**

   ```bash
   bun dev
   ```

4. **é–‹å•Ÿç€è¦½å™¨**

   è¨ªå• `http://localhost:3000`

### é–‹ç™¼æŒ‡ä»¤

| æŒ‡ä»¤         | èªªæ˜                     |
| ------------ | ------------------------ |
| `bun dev`    | å•Ÿå‹•é–‹ç™¼ä¼ºæœå™¨ï¼ˆç†±é‡è¼‰ï¼‰ |
| `bun build`  | å»ºæ§‹ç”Ÿç”¢ç‰ˆæœ¬             |
| `bun test`   | åŸ·è¡Œæ¸¬è©¦                 |
| `bun lint`   | åŸ·è¡Œ Linter              |
| `bun format` | æ ¼å¼åŒ–ç¨‹å¼ç¢¼             |

### API Server é–‹ç™¼

```bash
cd api-server
cargo run
```

---

## åˆ†æ”¯ç­–ç•¥

### ä¸»è¦åˆ†æ”¯

| åˆ†æ”¯      | ç”¨é€”               |
| --------- | ------------------ |
| `main`    | ç©©å®šç‰ˆæœ¬ï¼Œç”¨æ–¼ç™¼å¸ƒ |
| `develop` | é–‹ç™¼åˆ†æ”¯ï¼Œæ¥å— PR  |

### åŠŸèƒ½åˆ†æ”¯

å»ºç«‹æ–°åŠŸèƒ½æ™‚ï¼Œå¾ `develop` åˆ†æ”¯å»ºç«‹ï¼š

```bash
git checkout develop
git pull origin develop
git checkout -b feature/your-feature-name
```

### åˆ†æ”¯å‘½åè¦ç¯„

| é¡å‹ | æ ¼å¼            | ç¯„ä¾‹                              |
| ---- | --------------- | --------------------------------- |
| åŠŸèƒ½ | `feature/æè¿°`  | `feature/add-pdf-watermark`       |
| ä¿®å¾© | `fix/æè¿°`      | `fix/login-redirect-issue`        |
| æ–‡ä»¶ | `docs/æè¿°`     | `docs/update-api-docs`            |
| é‡æ§‹ | `refactor/æè¿°` | `refactor/improve-converter-perf` |

---

## æ¸¬è©¦æµç¨‹

### æ¸¬è©¦é¡å‹

| é¡å‹     | ä½ç½®                | èªªæ˜         |
| -------- | ------------------- | ------------ |
| å–®å…ƒæ¸¬è©¦ | `tests/`            | æ¸¬è©¦å€‹åˆ¥å‡½æ•¸ |
| æ•´åˆæ¸¬è©¦ | `tests/converters/` | æ¸¬è©¦è½‰æ›å™¨   |
| E2E æ¸¬è©¦ | `tests/e2e/`        | ç«¯å°ç«¯æ¸¬è©¦   |

### åŸ·è¡Œæ¸¬è©¦

```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
bun test

# åŸ·è¡Œç‰¹å®šæ¸¬è©¦
bun test tests/converters/

# åŸ·è¡Œ E2E æ¸¬è©¦
bun run test:e2e
```

### æ¸¬è©¦è¦†è“‹ç‡

```bash
bun test --coverage
```

### æ–°å¢æ¸¬è©¦

ç‚ºæ–°åŠŸèƒ½æ’°å¯«æ¸¬è©¦ï¼š

```typescript
// tests/converters/ffmpeg.test.ts
import { describe, it, expect } from "bun:test";
import { convertVideo } from "@/converters/ffmpeg";

describe("FFmpeg Converter", () => {
  it("should convert MP4 to WebM", async () => {
    const result = await convertVideo("input.mp4", "webm");
    expect(result.success).toBe(true);
  });
});
```

---

## æäº¤è¦ç¯„

### Commit Message æ ¼å¼

```
<type>(<scope>): <subject>

<body>

<footer>
```

### Type é¡å‹

| Type       | èªªæ˜                     |
| ---------- | ------------------------ |
| `feat`     | æ–°åŠŸèƒ½                   |
| `fix`      | ä¿®å¾© Bug                 |
| `docs`     | æ–‡ä»¶æ›´æ–°                 |
| `style`    | ç¨‹å¼ç¢¼é¢¨æ ¼ï¼ˆä¸å½±éŸ¿åŠŸèƒ½ï¼‰ |
| `refactor` | é‡æ§‹ï¼ˆä¸æ–°å¢åŠŸèƒ½æˆ–ä¿®å¾©ï¼‰ |
| `perf`     | æ•ˆèƒ½å„ªåŒ–                 |
| `test`     | æ–°å¢æˆ–ä¿®æ”¹æ¸¬è©¦           |
| `chore`    | å»ºæ§‹æˆ–è¼”åŠ©å·¥å…·è®Šå‹•       |

### ç¯„ä¾‹

```
feat(converter): æ–°å¢ AVIF æ ¼å¼æ”¯æ´

- åœ¨ ImageMagick è½‰æ›å™¨æ–°å¢ AVIF è¼¸å…¥/è¼¸å‡º
- æ›´æ–°æ ¼å¼æ”¯æ´åˆ—è¡¨

Closes #123
```

```
fix(auth): ä¿®å¾©ç™»å…¥å¾Œé‡å°å‘å•é¡Œ

ç•¶ HTTP_ALLOWED=false ä¸”ä½¿ç”¨ HTTP å­˜å–æ™‚ï¼Œ
Cookie ç„¡æ³•æ­£ç¢ºè¨­å®šå°è‡´ç™»å…¥å¤±æ•—ã€‚

ä¿®å¾©æ–¹å¼ï¼šåœ¨è¨­å®š Cookie å‰æª¢æŸ¥å”è­°ã€‚

Fixes #456
```

### æäº¤å‰æª¢æŸ¥

```bash
# åŸ·è¡Œ Linter
bun lint

# åŸ·è¡Œæ¸¬è©¦
bun test

# æ ¼å¼åŒ–ç¨‹å¼ç¢¼
bun format
```

---

## Pull Request æµç¨‹

### æäº¤ PR å‰

1. ç¢ºä¿ç¨‹å¼ç¢¼é€šéæ‰€æœ‰æ¸¬è©¦
2. ç¢ºä¿ç¨‹å¼ç¢¼ç¬¦åˆé¢¨æ ¼è¦ç¯„
3. æ›´æ–°ç›¸é—œæ–‡ä»¶
4. æ’°å¯«æ¸…æ¥šçš„ PR æè¿°

### PR ç¯„æœ¬

```markdown
## è®Šæ›´æè¿°

ç°¡è¿°é€™å€‹ PR åšäº†ä»€éº¼ã€‚

## è®Šæ›´é¡å‹

- [ ] æ–°åŠŸèƒ½
- [ ] Bug ä¿®å¾©
- [ ] æ–‡ä»¶æ›´æ–°
- [ ] é‡æ§‹
- [ ] å…¶ä»–

## æ¸¬è©¦

æè¿°å¦‚ä½•æ¸¬è©¦é€™äº›è®Šæ›´ã€‚

## ç›¸é—œ Issue

Closes #123

## æˆªåœ–ï¼ˆå¦‚é©ç”¨ï¼‰
```

### å¯©æ ¸æµç¨‹

1. æäº¤ PR åˆ° `develop` åˆ†æ”¯
2. ç­‰å¾… CI é€šé
3. è«‹æ±‚ Review
4. æ ¹æ“šå›é¥‹ä¿®æ”¹
5. åˆä½µ

---

## ç¨‹å¼ç¢¼é¢¨æ ¼

### TypeScript / JavaScript

ä½¿ç”¨ Biome é€²è¡Œ Linting å’Œæ ¼å¼åŒ–ï¼š

```bash
# æª¢æŸ¥
bun lint

# æ ¼å¼åŒ–
bun format
```

### ä¸»è¦è¦ç¯„

- ä½¿ç”¨ 2 ç©ºæ ¼ç¸®æ’
- ä½¿ç”¨å–®å¼•è™Ÿ
- ä¸ä½¿ç”¨åˆ†è™Ÿï¼ˆé™¤éå¿…è¦ï¼‰
- ä½¿ç”¨ `const` / `let`ï¼Œé¿å… `var`
- ä½¿ç”¨ç®­é ­å‡½æ•¸

### ç¯„ä¾‹

```typescript
// âœ… æ­£ç¢º
const formatConverter = (name: string): string => {
  return name.toLowerCase();
};

// âŒ éŒ¯èª¤
function formatConverter(name) {
  return name.toLowerCase();
}
```

### Rust

éµå¾ª Rust å®˜æ–¹é¢¨æ ¼æŒ‡å—ï¼š

```bash
cargo fmt --check
cargo clippy
```

---

## æ–°å¢è½‰æ›å™¨

### æ­¥é©Ÿ

1. åœ¨ `src/converters/` å»ºç«‹æ–°æª”æ¡ˆ

2. å®šç¾©è½‰æ›å™¨ï¼š

   ```typescript
   // src/converters/myconverter.ts
   import { Converter } from "./types";

   export const myConverter: Converter = {
     name: "myconverter",
     inputFormats: ["xyz", "abc"],
     outputFormats: ["pdf", "png"],
     convert: async (input, output, options) => {
       // è½‰æ›é‚è¼¯
     },
   };
   ```

3. åœ¨ `src/converters/main.ts` è¨»å†Š

4. æ–°å¢æ¸¬è©¦

5. æ›´æ–°æ–‡ä»¶

---

## åœ‹éš›åŒ–

### æ–°å¢ç¿»è­¯

1. åœ¨ `src/locales/` æ‰¾åˆ°å°æ‡‰èªè¨€æª”æ¡ˆ

2. æ–°å¢ç¿»è­¯å­—ä¸²ï¼š

   ```json
   {
     "converter.newFeature": "æ–°åŠŸèƒ½èªªæ˜"
   }
   ```

3. åœ¨æ‰€æœ‰èªè¨€æª”æ¡ˆä¸­æ–°å¢ç›¸åŒçš„ Key

### æ–°å¢èªè¨€

1. åœ¨ `src/locales/` å»ºç«‹æ–°çš„èªè¨€æª”æ¡ˆ

2. åœ¨ `src/i18n/index.ts` è¨»å†Šæ–°èªè¨€

---

## ç™¼å¸ƒæµç¨‹

### ç‰ˆæœ¬è™Ÿè¦å‰‡

éµå¾ª [Semantic Versioning](https://semver.org/)ï¼š

- `MAJOR.MINOR.PATCH`
- MAJORï¼šä¸ç›¸å®¹çš„ API è®Šæ›´
- MINORï¼šå‘ä¸‹ç›¸å®¹çš„æ–°åŠŸèƒ½
- PATCHï¼šå‘ä¸‹ç›¸å®¹çš„ Bug ä¿®å¾©

### ç™¼å¸ƒæ­¥é©Ÿ

1. æ›´æ–° `CHANGELOG.md`
2. æ›´æ–°ç‰ˆæœ¬è™Ÿ
3. å»ºç«‹ Release Tag
4. CI è‡ªå‹•å»ºæ§‹ä¸¦ç™¼å¸ƒ Docker Image

---

[â¬†ï¸ å›åˆ°é ‚éƒ¨](#é–‹ç™¼èˆ‡è²¢ç»æŒ‡å—) | [ğŸ“š å›åˆ°ç›®éŒ„](00-å°ˆæ¡ˆç¸½è¦½.md)

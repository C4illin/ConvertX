# ==============================================================================
# ConvertX-CN 完整參考 Docker Compose
#
# 📚 這是所有可用設定的完整參考
#    大部分設定都有預設值，不需要全部設定
#    請根據需求取消註解並修改
#
# 🎯 設定分類：
#    [必填] - 生產環境必須設定
#    [建議] - 建議設定以獲得最佳體驗
#    [可選] - 依需求設定
#    [進階] - 特殊情境才需要
# ==============================================================================

services:
  convertx:
    image: convertx/convertx-cn:latest
    container_name: convertx-cn
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      - ./data:/app/data

    environment:
      # =========================================================================
      # [必填] 安全性設定
      # =========================================================================

      # JWT 密鑰：用於使用者登入驗證的加密金鑰
      # ⚠️ 生產環境必須設定固定值，否則每次重啟所有人都會被登出
      # 產生方式：openssl rand -hex 32
      - JWT_SECRET=your-very-long-random-secret-key-at-least-32-characters

      # =========================================================================
      # [建議] 基本設定
      # =========================================================================

      # 時區設定：影響檔案時間戳記與日期顯示
      - TZ=Asia/Taipei

      # 帳號註冊：是否允許新使用者註冊
      # true  = 開放註冊
      # false = 關閉註冊（首次帳號不受限制）
      - ACCOUNT_REGISTRATION=false

      # 自動清理：自動刪除超過 N 小時的轉換檔案
      # 0 = 停用自動清理
      - AUTO_DELETE_EVERY_N_HOURS=24

      # =========================================================================
      # [可選] HTTP / HTTPS 設定
      # =========================================================================

      # HTTP 存取：是否允許非 HTTPS 連線
      # true  = 允許 HTTP（本地測試用）
      # false = 必須 HTTPS（生產環境建議）
      - HTTP_ALLOWED=false

      # 信任 Proxy：透過 Reverse Proxy 存取時設為 true
      # 讓應用正確判斷 X-Forwarded-Proto 等 headers
      - TRUST_PROXY=false

      # =========================================================================
      # [可選] 存取控制
      # =========================================================================

      # 未登入存取：是否允許未登入使用者使用轉換功能
      # true  = 允許匿名使用（公開服務）
      # false = 必須登入
      - ALLOW_UNAUTHENTICATED=false

      # 未登入使用者共享空間：匿名使用者是否共享同一個檔案空間
      # true  = 共享（所有匿名使用者看到相同檔案）
      # false = 獨立（以 session 區分）
      # - UNAUTHENTICATED_USER_SHARING=false

      # =========================================================================
      # [可選] 介面設定
      # =========================================================================

      # 子路徑部署：若透過子路徑存取（如 /convertx），設定此值
      # 範例：https://example.com/convertx/ → WEBROOT=/convertx
      # - WEBROOT=/convertx

      # 隱藏歷史：是否隱藏轉換歷史頁面
      # - HIDE_HISTORY=true

      # 日期格式語言：影響介面上的日期顯示格式
      # 使用 BCP 47 語言標籤
      # - LANGUAGE=zh-TW

      # =========================================================================
      # [進階] 轉換設定
      # =========================================================================

      # 最大同時轉換數：限制同時進行的轉換任務數量
      # 0 = 無限制
      # - MAX_CONVERT_PROCESS=4

      # FFmpeg 輸入參數：用於硬體加速等
      # - FFMPEG_ARGS=-hwaccel cuda
      # - FFMPEG_ARGS=-hwaccel qsv
      # - FFMPEG_ARGS=-hwaccel vaapi

      # FFmpeg 輸出參數：用於編碼設定等
      # - FFMPEG_OUTPUT_ARGS=-preset veryfast

# ==============================================================================
# 環境變數快速參考
# ==============================================================================
#
# | 變數名稱                      | 預設值     | 說明                      |
# |-------------------------------|------------|---------------------------|
# | JWT_SECRET                    | random     | JWT 簽署密鑰              |
# | TZ                            | UTC        | 時區                      |
# | ACCOUNT_REGISTRATION          | true       | 是否開放註冊              |
# | HTTP_ALLOWED                  | false      | 是否允許 HTTP             |
# | TRUST_PROXY                   | false      | 是否信任 Reverse Proxy    |
# | ALLOW_UNAUTHENTICATED         | false      | 是否允許未登入使用        |
# | AUTO_DELETE_EVERY_N_HOURS     | 24         | 自動清理時間（小時）      |
# | WEBROOT                       | (空)       | 子路徑部署                |
# | HIDE_HISTORY                  | false      | 隱藏歷史頁面              |
# | LANGUAGE                      | en         | 日期格式語言              |
# | MAX_CONVERT_PROCESS           | 0          | 最大同時轉換數            |
# | FFMPEG_ARGS                   | (空)       | FFmpeg 輸入參數           |
# | FFMPEG_OUTPUT_ARGS            | (空)       | FFmpeg 輸出參數           |
# | UNAUTHENTICATED_USER_SHARING  | false      | 匿名使用者共享空間        |
#
# 完整說明請見：docs/environment-variables.md
# ==============================================================================

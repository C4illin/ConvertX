# éƒ¨ç½²æŒ‡å—

è©³ç´°èªªæ˜ ConvertX-CN çš„å„ç¨®éƒ¨ç½²æ–¹å¼èˆ‡é€²éšé…ç½®ã€‚

---

## ç›®éŒ„

- [æœ¬åœ°éƒ¨ç½²æ­¥é©Ÿ](#æœ¬åœ°éƒ¨ç½²æ­¥é©Ÿ)
- [Docker è¨­å®š](#docker-è¨­å®š)
- [åå‘ä»£ç†è¨­å®š](#åå‘ä»£ç†è¨­å®š)
- [HTTPS è¨­å®š](#https-è¨­å®š)
- [æ›´æ–°èˆ‡ç¶­è­·](#æ›´æ–°èˆ‡ç¶­è­·)

---

## æœ¬åœ°éƒ¨ç½²æ­¥é©Ÿ

### ç³»çµ±éœ€æ±‚

| é …ç›® | æœ€ä½éœ€æ±‚ | å»ºè­°é…ç½® |
|------|---------|---------|
| CPU | 2 æ ¸å¿ƒ | 4 æ ¸å¿ƒä»¥ä¸Š |
| è¨˜æ†¶é«” | 4 GB | 8 GB ä»¥ä¸Š |
| ç£ç¢Ÿç©ºé–“ | 10 GB | 30 GB SSD |
| ç¶²è·¯ | 10 Mbps | 100 Mbps |

### æº–å‚™å·¥ä½œ

1. **å®‰è£ Docker**

   ```bash
   # Ubuntu / Debian
   curl -fsSL https://get.docker.com | sh
   sudo usermod -aG docker $USER
   
   # CentOS / RHEL
   sudo yum install -y docker
   sudo systemctl start docker
   sudo systemctl enable docker
   ```

2. **å»ºç«‹å°ˆæ¡ˆç›®éŒ„**

   ```bash
   mkdir -p ~/convertx-cn/data
   cd ~/convertx-cn
   ```

3. **ç”¢ç”Ÿ JWT å¯†é‘°**

   ```bash
   # Linux / macOS
   openssl rand -hex 32
   
   # Windows PowerShell
   -join ((1..32) | ForEach-Object { '{0:x2}' -f (Get-Random -Max 256) })
   ```

---

## Docker è¨­å®š

### åŸºæœ¬éƒ¨ç½²

```yaml
# docker-compose.yml
services:
  convertx:
    image: convertx/convertx-cn:latest
    container_name: convertx-cn
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      - ./data:/app/data
    environment:
      - TZ=Asia/Taipei
      - JWT_SECRET=æ‚¨çš„éš¨æ©Ÿå¯†é‘°è‡³å°‘32å­—å…ƒ
```

### é€²éšéƒ¨ç½²ï¼ˆå«è³‡æºé™åˆ¶ï¼‰

```yaml
# docker-compose.yml
services:
  convertx:
    image: convertx/convertx-cn:latest
    container_name: convertx-cn
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      - ./data:/app/data
    environment:
      - TZ=Asia/Taipei
      - JWT_SECRET=æ‚¨çš„éš¨æ©Ÿå¯†é‘°è‡³å°‘32å­—å…ƒ
      - MAX_CONVERT_PROCESS=4
      - AUTO_DELETE_EVERY_N_HOURS=12
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
        reservations:
          cpus: '2'
          memory: 4G
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000/health"]
      interval: 30s
      timeout: 10s
      retries: 3
```

### Lite ç‰ˆéƒ¨ç½²

é©ç”¨æ–¼è³‡æºæœ‰é™æˆ–åªéœ€è¦åŸºæœ¬è½‰æ›åŠŸèƒ½çš„ç’°å¢ƒï¼š

```yaml
# docker-compose.yml
services:
  convertx:
    image: convertx/convertx-cn:latest-lite
    container_name: convertx-cn-lite
    restart: unless-stopped
    ports:
      - "3000:3000"
    volumes:
      - ./data:/app/data
    environment:
      - TZ=Asia/Taipei
      - JWT_SECRET=æ‚¨çš„éš¨æ©Ÿå¯†é‘°è‡³å°‘32å­—å…ƒ
```

### ç’°å¢ƒè®Šæ•¸èªªæ˜

| è®Šæ•¸ | èªªæ˜ | é è¨­å€¼ |
|------|------|--------|
| `JWT_SECRET` | ç™»å…¥é©—è­‰é‡‘é‘°ï¼ˆ**å¿…å¡«**ï¼‰ | éš¨æ©Ÿï¼ˆæ¯æ¬¡é‡å•Ÿè®Šï¼‰ |
| `TZ` | æ™‚å€ | `UTC` |
| `HTTP_ALLOWED` | å…è¨± HTTP é€£ç·š | `false` |
| `TRUST_PROXY` | ä¿¡ä»»åå‘ä»£ç† | `false` |

> ğŸ“– å®Œæ•´è®Šæ•¸åˆ—è¡¨è«‹åƒé–± [03-ç’°å¢ƒè®Šæ•¸èˆ‡è¨­å®š](03-ç’°å¢ƒè®Šæ•¸èˆ‡è¨­å®š.md)

---

## åå‘ä»£ç†è¨­å®š

### Nginx è¨­å®š

```nginx
# /etc/nginx/sites-available/convertx
server {
    listen 80;
    server_name convertx.example.com;
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name convertx.example.com;

    # SSL æ†‘è­‰ï¼ˆLet's Encryptï¼‰
    ssl_certificate /etc/letsencrypt/live/convertx.example.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/convertx.example.com/privkey.pem;

    # SSL å®‰å…¨è¨­å®š
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers on;
    ssl_ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256;

    # æª”æ¡ˆä¸Šå‚³å¤§å°é™åˆ¶
    client_max_body_size 500M;

    # è¶…æ™‚è¨­å®šï¼ˆå¤§æª”æ¡ˆè½‰æ›éœ€è¦ï¼‰
    proxy_read_timeout 3600s;
    proxy_send_timeout 3600s;

    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;

        # å¿…è¦çš„ headers
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;

        # WebSocket æ”¯æ´
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
}
```

**å•Ÿç”¨è¨­å®šï¼š**

```bash
sudo ln -s /etc/nginx/sites-available/convertx /etc/nginx/sites-enabled/
sudo nginx -t
sudo systemctl reload nginx
```

### Traefik è¨­å®š

```yaml
# docker-compose.yml
services:
  convertx:
    image: convertx/convertx-cn:latest
    container_name: convertx-cn
    restart: unless-stopped
    volumes:
      - ./data:/app/data
    environment:
      - JWT_SECRET=${JWT_SECRET}
      - TRUST_PROXY=true
      - HTTP_ALLOWED=false
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.convertx.rule=Host(`convertx.example.com`)"
      - "traefik.http.routers.convertx.entrypoints=websecure"
      - "traefik.http.routers.convertx.tls.certresolver=letsencrypt"
      - "traefik.http.services.convertx.loadbalancer.server.port=3000"
```

### Caddy è¨­å®š

```
# Caddyfile
convertx.example.com {
    reverse_proxy localhost:3000
}
```

### åå‘ä»£ç†å¿…è¦è¨­å®š

ä½¿ç”¨åå‘ä»£ç†æ™‚ï¼Œè«‹ç¢ºä¿è¨­å®šä»¥ä¸‹ç’°å¢ƒè®Šæ•¸ï¼š

```yaml
environment:
  - TRUST_PROXY=true      # ä¿¡ä»»åå‘ä»£ç†çš„ headers
  - HTTP_ALLOWED=false    # åå‘ä»£ç†å·²è™•ç† HTTPS
```

---

## HTTPS è¨­å®š

### ä½¿ç”¨ Let's Encrypt

1. **å®‰è£ Certbot**

   ```bash
   # Ubuntu / Debian
   sudo apt install certbot python3-certbot-nginx
   
   # CentOS / RHEL
   sudo yum install certbot python3-certbot-nginx
   ```

2. **å–å¾—æ†‘è­‰**

   ```bash
   sudo certbot --nginx -d convertx.example.com
   ```

3. **è‡ªå‹•çºŒç´„**

   ```bash
   sudo certbot renew --dry-run
   ```

### ä½¿ç”¨è‡ªç°½æ†‘è­‰ï¼ˆæ¸¬è©¦ç”¨ï¼‰

```bash
# ç”¢ç”Ÿè‡ªç°½æ†‘è­‰
openssl req -x509 -nodes -days 365 -newkey rsa:2048 \
  -keyout /etc/ssl/private/convertx.key \
  -out /etc/ssl/certs/convertx.crt \
  -subj "/CN=convertx.local"
```

---

## æ›´æ–°èˆ‡ç¶­è­·

### æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬

```bash
# é€²å…¥å°ˆæ¡ˆç›®éŒ„
cd ~/convertx-cn

# åœæ­¢ä¸¦æ›´æ–°
docker compose down
docker compose pull
docker compose up -d

# æ¸…ç†èˆŠæ˜ åƒæª”
docker image prune -f
```

### å‚™ä»½è³‡æ–™

```bash
# å‚™ä»½è³‡æ–™ç›®éŒ„
tar -czvf convertx-backup-$(date +%Y%m%d).tar.gz ./data

# é‚„åŸè³‡æ–™
tar -xzvf convertx-backup-20260125.tar.gz
```

### æŸ¥çœ‹æ—¥èªŒ

```bash
# å³æ™‚æ—¥èªŒ
docker logs -f convertx-cn

# æœ€è¿‘ 100 è¡Œ
docker logs --tail 100 convertx-cn

# æŒ‡å®šæ™‚é–“ç¯„åœ
docker logs --since "2026-01-25T00:00:00" convertx-cn
```

### é‡æ–°å•Ÿå‹•

```bash
# é‡æ–°å•Ÿå‹•å®¹å™¨
docker restart convertx-cn

# å®Œå…¨é‡å»º
docker compose down
docker compose up -d --force-recreate
```

---

## é€²éšé…ç½®

### ä½¿ç”¨å¤–éƒ¨è³‡æ–™åº«

```yaml
services:
  convertx:
    image: convertx/convertx-cn:latest
    environment:
      - DATABASE_URL=sqlite:///app/data/mydb.sqlite
    volumes:
      - ./data:/app/data
```

### è¨­å®š API Server

```yaml
services:
  convertx:
    image: convertx/convertx-cn:latest
    ports:
      - "3000:3000"
    volumes:
      - ./data:/app/data
    environment:
      - JWT_SECRET=${JWT_SECRET}

  api-server:
    image: convertx/convertx-cn-api:latest
    ports:
      - "3001:3001"
    environment:
      - JWT_SECRET=${JWT_SECRET}
      - API_PORT=3001
    depends_on:
      - convertx
```

---

[â¬†ï¸ å›åˆ°é ‚éƒ¨](#éƒ¨ç½²æŒ‡å—) | [ğŸ“š å›åˆ°ç›®éŒ„](00-å°ˆæ¡ˆç¸½è¦½.md)

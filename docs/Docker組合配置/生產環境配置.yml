# ==============================================================================
# ConvertX-CN ç”Ÿç”¢ç’°å¢ƒ Docker Compose
#
# é©ç”¨æƒ…å¢ƒï¼š
#   - é€é Reverse Proxyï¼ˆNginx / Traefik / Caddyï¼‰å­˜å–
#   - å·²è¨­å®š HTTPS
#   - éœ€è¦é™åˆ¶è¨»å†Šèˆ‡å­˜å–
#
# âš ï¸ ä½¿ç”¨å‰è«‹ç¢ºèªï¼š
#    1. å·²å»ºç«‹ data è³‡æ–™å¤¾
#    2. å·²å°‡ JWT_SECRET æ”¹æˆä½ è‡ªå·±çš„å€¼
#    3. å·²è¨­å®šå¥½ Reverse Proxy
# ==============================================================================

services:
  convertx:
    image: convertx/convertx-cn:latest
    container_name: convertx-cn
    restart: unless-stopped

    # ç”Ÿç”¢ç’°å¢ƒé€šå¸¸åªç›£è½ localhostï¼Œç”± Reverse Proxy è½‰ç™¼
    # è‹¥éœ€è¦ç›´æ¥å°å¤–ï¼Œæ”¹ç‚º "3000:3000"
    ports:
      - "127.0.0.1:3000:3000"

    volumes:
      - ./data:/app/data

    environment:
      # === å¿…å¡«è¨­å®š ===
      # ğŸ” JWT å¯†é‘°ï¼šè«‹å‹™å¿…æ”¹æˆä½ è‡ªå·±çš„éš¨æ©Ÿå­—ä¸²ï¼ˆè‡³å°‘ 32 å­—å…ƒï¼‰
      # å¯ç”¨ openssl rand -hex 32 ç”¢ç”Ÿ
      - JWT_SECRET=change-me-to-a-very-long-random-string-at-least-32-characters

      # === å®‰å…¨è¨­å®š ===
      # é—œé–‰è¨»å†Šï¼ˆé¦–æ¬¡å¸³è™Ÿä»å¯å»ºç«‹ï¼‰
      - ACCOUNT_REGISTRATION=false

      # ä¸å…è¨± HTTPï¼ˆè¦æ±‚ HTTPSï¼‰
      - HTTP_ALLOWED=false

      # ä¿¡ä»» Reverse Proxy çš„ X-Forwarded-* headers
      - TRUST_PROXY=true

      # å¿…é ˆç™»å…¥æ‰èƒ½ä½¿ç”¨
      - ALLOW_UNAUTHENTICATED=false

      # === æ™‚å€èˆ‡æ¸…ç† ===
      - TZ=Asia/Taipei
      - AUTO_DELETE_EVERY_N_HOURS=24

      # === å¯é¸ï¼šå­è·¯å¾‘éƒ¨ç½² ===
      # è‹¥é€é https://example.com/convertx/ å­˜å–ï¼Œå–æ¶ˆä¸‹è¡Œè¨»è§£
      # - WEBROOT=/convertx

# ==============================================================================
# Reverse Proxy è¨­å®šç¯„ä¾‹
# ==============================================================================
#
# Nginx ç¯„ä¾‹ï¼š
# -------------
# server {
#     listen 443 ssl http2;
#     server_name example.com;
#
#     location / {
#         proxy_pass http://127.0.0.1:3000;
#         proxy_set_header Host $host;
#         proxy_set_header X-Real-IP $remote_addr;
#         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
#         proxy_set_header X-Forwarded-Proto $scheme;
#
#         # æª”æ¡ˆä¸Šå‚³å¤§å°é™åˆ¶
#         client_max_body_size 500M;
#     }
# }
#
# Traefik ç¯„ä¾‹ï¼ˆlabelsï¼‰ï¼š
# ------------------------
# labels:
#   - "traefik.enable=true"
#   - "traefik.http.routers.convertx.rule=Host(`convertx.example.com`)"
#   - "traefik.http.routers.convertx.tls=true"
#   - "traefik.http.routers.convertx.tls.certresolver=letsencrypt"
#   - "traefik.http.services.convertx.loadbalancer.server.port=3000"
#
# ==============================================================================
